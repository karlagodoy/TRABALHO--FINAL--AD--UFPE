require(foreign)
require(nnet)
require(ggplot2)
require(reshape2)
require(effects)
require(tidyverse)
require(coefplot)
require(readxl)
require(dplyr)
install.packages("texreg")
require(texreg)
install.packages("olsrr")
require(olsrr)
require (fields)
require(lmtest)


options(scipen= 999, digits= 5)

## Agrupando dados para formar base de dados 

# Variavel Sustentabilidade

setwd("C:/Users/karla/Desktop/Artigo desenvolvimento sustentavel")

Data_ENVIRONMENTAL <- read_excel("ENVIRONMENTAL_PERFORMANCE_2018.xlsx", sheet = 1)

summary(Data_ENVIRONMENTAL)

Score_Numeric <- as.numeric(as.character(Data_ENVIRONMENTAL$SCORE))

DataEnvi<- add_column(Data_ENVIRONMENTAL, Score_Numeric)

summary(DataEnvi)

str(DataEnvi)

## Democracia

setwd("C:/Users/karla/Desktop/Artigo desenvolvimento sustentavel")

Data_DEMOCRACY <- read_excel("Democracy_Index_2018.xlsx", sheet = 1)

Data_DEMOCRACY_2018 <- Data_DEMOCRACY %>% group_by(Code) %>% summarise(`Overall score`)

summary(Data_DEMOCRACY_2018)

Overall_Numeric<- as.numeric(as.character(Data_DEMOCRACY_2018$`Overall score`))

DataDemoc <- add_column(Data_DEMOCRACY_2018, Overall_Numeric )

summary(DataDemoc)

str(DataDemoc)

# Capacidade de Governo 

setwd("C:/Users/karla/Desktop/Artigo desenvolvimento sustentavel")

Data_Gov_Eff<- read.delim("Gov_Effect.txt", header = TRUE, sep = "\t", dec = ".")

summary(Data_Gov_Eff)

Estimate_Numeric<- as.numeric(as.character(Data_Gov_Eff$`Estimate`))

summary(Estimate_Numeric)

DataGovEffet <- add_column(Data_Gov_Eff, Estimate_Numeric)

str(DataGovEffet)

summary(DataGovEffet)


# GPD

setwd("C:/Users/karla/Desktop/Artigo desenvolvimento sustentavel")

Data_GDP<- read_excel("GDP_Percapita_2018.xlsx", sheet = 1)

Data_GDP_2018 <- na.omit (Data_GDP)

Data_GDP_Percapita <- Data_GDP_2018 %>% group_by(`Code`) %>% summarise(`2018 [YR2018]`)

GDP_Numeric<- as.numeric(as.character(Data_GDP_Percapita$`2018 [YR2018]`))

summary(GDP_Numeric)

DataGDP <- add_column(Data_GDP_Percapita, GDP_Numeric)

str(DataGDP)

summary(DataGDP)

# Unindo Sustentabilidade, Democracia e Capacidade de Governo 

Env_Demo <- DataEnvi %>% full_join (DataDemoc, by = c("Code"))

Env_Demo_EFF <- DataGovEffet %>% full_join(Env_Demo, by = c("Code"))

Env_Demo_EFF_GDP <- Env_Demo_EFF %>% full_join(DataGDP, by = c("Code"))

# Excluindo colunas em Caracteres

summary(Env_Demo_EFF_GDP)

Env_Demo_EFF_GDP$Estimate <- NULL

Env_Demo_EFF_GDP$`Overall score` <- NULL

Env_Demo_EFF_GDP$SCORE<- NULL

Env_Demo_EFF_GDP$`2018 [YR2018]` <- NULL

summary(Env_Demo_EFF_GDP)

# Mudando o nome das variÃ¡veis 

names(Env_Demo_EFF_GDP)[grep('Estimate_Numeric', names(Env_Demo_EFF_GDP))] <- 'GovEffect'

names(Env_Demo_EFF_GDP)[grep('Score_Numeric', names(Env_Demo_EFF_GDP))] <- 'EnvironPerfor'

names(Env_Demo_EFF_GDP)[grep('Overall_Numeric', names(Env_Demo_EFF_GDP))] <- 'Democ'

names(Env_Demo_EFF_GDP)[grep('GDP_Numeric', names(Env_Demo_EFF_GDP))] <- 'GDP'

names (Env_Demo_EFF_GDP)


## Salvando base de dados 

setwd("C:/Users/karla/Desktop/Artigo desenvolvimento sustentavel")

save(Env_Demo_EFF_GDP, file = "karla-godoy-ad-ufpe-2019.RData")
write.csv2(Env_Demo_EFF_GDP, file = "karla-godoy-ad-ufpe-2019.csv",
           row.names = F)

## AnÃ¡lise discritiva dos dados 


summary (Env_Demo_EFF_GDP)

str(Env_Demo_EFF_GDP)

# observando a distribuicao das variaveis:

ggplot(Env_Demo_EFF_GDP, aes(Democ))+geom_density()

ggplot(Env_Demo_EFF_GDP, aes(GDP))+geom_density()

ggplot(Env_Demo_EFF_GDP, aes(GovEffect))+geom_density()

# Analisando  a dispersao conjunta das variaveis

ggplot(data = Env_Demo_EFF_GDP, mapping = aes(Democ, EnvironPerfor)) + 
  geom_point()

ggplot(data = Env_Demo_EFF_GDP, mapping = aes(GovEffect, EnvironPerfor)) + 
  geom_point()

ggplot(data = Env_Demo_EFF_GDP, mapping = aes(GDP,EnvironPerfor)) + 
  geom_point()


# calculando a correlacao entre elas

cor.test(Env_Demo_EFF_GDP$Democ, Env_Demo_EFF_GDP$EnvironPerfor)
cor.test(Env_Demo_EFF_GDP$GovEffect, Env_Demo_EFF_GDP$EnvironPerfor)
cor.test(Env_Demo_EFF_GDP$GDP, Env_Demo_EFF_GDP$EnvironPerfor)


## Realizando Regressao com as variaveis independentes


# Desempenho Ambiental- Democracia

Modelo1 <- lm( EnvironPerfor~ Democ, data= Env_Demo_EFF_GDP)

summary(Modelo1)


# Call:
# lm(formula = EnvironPerfor ~ Democ, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min     1Q Median     3Q    Max 
# -32.48  -5.65   0.38   7.60  24.96 

# Coefficients:
#  Estimate Std. Error t value            Pr(>|t|)    
# (Intercept)   34.296      2.234    15.3 <0.0000000000000002 ***
#  Democ          3.976      0.375    10.6 <0.0000000000000002 ***
  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 10.3 on 161 degrees of freedom
# (35 observations deleted due to missingness)
# Multiple R-squared:  0.412,	Adjusted R-squared:  0.408 
# F-statistic:  113 on 1 and 161 DF,  p-value: <0.0000000000000002

plot(reg_2)
confint(reg_2)
rmse(reg_2$residuals)  
  
## Desempenho Ambiental- Democracia+ Efetividade do Governo
  
  
Modelo2 <- lm(EnvironPerfor ~ GovEffect, data= Env_Demo_EFF_GDP)

summary(Modelo2)


# Call:
# lm(formula = EnvironPerfor ~ GovEffect, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min      1Q  Median      3Q     Max 
# -26.673  -5.607   0.814   5.892  22.224 

# Coefficients:
#  Estimate Std. Error t value            Pr(>|t|)    
# (Intercept)   56.317      0.623    90.4 <0.0000000000000002 ***
#  GovEffect     10.282      0.663    15.5 <0.0000000000000002 ***
  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 8.33 on 177 degrees of freedom
# (19 observations deleted due to missingness)
# Multiple R-squared:  0.576,	Adjusted R-squared:  0.574 
# F-statistic:  240 on 1 and 177 DF,  p-value: <0.0000000000000002


  plot(reg_2)
confint(reg_2)
rmse(reg_2$residuals)

# Desempenho Ambiental-  PIB

Modelo3 <- lm(EnvironPerfor ~ GDP, data= Env_Demo_EFF_GDP)

summary (Modelo3)

# Call:
# lm(formula = EnvironPerfor ~ GDP, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min     1Q Median     3Q    Max 
# -33.84  -4.91   1.59   7.06  17.42 

# Coefficients:
#  Estimate Std. Error t value            Pr(>|t|)    
# (Intercept) 46.5728563  1.0375522    44.9 <0.0000000000000002 ***
#  GDP          0.0004350  0.0000332    13.1 <0.0000000000000002 ***
  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 9.11 on 138 degrees of freedom
# (58 observations deleted due to missingness)
# Multiple R-squared:  0.554,	Adjusted R-squared:  0.551 
# F-statistic:  172 on 1 and 138 DF,  p-value: <0.0000000000000002

plot(Modelo3)
confint(reg_2)
rmse(reg_2$residuals)


## Regressão Multivariada sem transformação

Modelo4 <- lm(EnvironPerfor ~ Democ + GovEffect+ GDP, data= Env_Demo_EFF_GDP)

summary(Modelo4)

# Call:
#  lm(formula = EnvironPerfor ~ Democ + GovEffect + GDP, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min      1Q  Median      3Q     Max 
# -24.783  -4.223   0.364   5.000  21.189 
 
# Coefficients:
#  Estimate Std. Error t value             Pr(>|t|)    
# (Intercept) 43.0797342  2.8500058   15.12 < 0.0000000000000002 ***
#  Democ        1.3938839  0.4422712    3.15               0.0020 ** 
#  GovEffect    4.1976073  1.2793344    3.28               0.0013 ** 
#  GDP          0.0002342  0.0000436    5.37           0.00000033 ***
#  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 7.72 on 135 degrees of freedom
# (59 observations deleted due to missingness)
# Multiple R-squared:  0.682,	Adjusted R-squared:  0.675 
# F-statistic: 96.4 on 3 and 135 DF,  p-value: <0.0000000000000002

confint(Modelo4)

# 2.5 %      97.5 %
#  (Intercept) 37.44329984 48.71616862
# Democ        0.51920752  2.26856037
# GovEffect    1.66747746  6.72773713
# GDP          0.00014802  0.00032042

## Transformando GDP em lGDP

lGDP <- log(Env_Demo_EFF_GDP$GDP)

ggplot(Env_Demo_EFF_GDP, aes(lGDP, EnvironPerfor))+geom_point()

cor.test(Env_Demo_EFF_GDP$EnvironPerfor, lGDP)

Modelo3.1 <- lm(EnvironPerfor ~ lGDP, data = Env_Demo_EFF_GDP)

summary(Modelo3.1)

# Call:
# lm(formula = EnvironPerfor ~ lGDP, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min     1Q Median     3Q    Max 
# -21.76  -4.81   1.71   4.89  14.95 

# Coefficients:
#  Estimate Std. Error t value             Pr(>|t|)    
# (Intercept)   -31.69       4.79   -6.61        0.00000000076 ***
#  lGDP            9.38       0.51   18.39 < 0.0000000000000002 ***
  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 7.35 on 138 degrees of freedom
# (58 observations deleted due to missingness)
# Multiple R-squared:  0.71,	Adjusted R-squared:  0.708 
# F-statistic:  338 on 1 and 138 DF,  p-value: <0.0000000000000002

confint(Modelo3.1)

#             2.5 %  97.5 %
# (Intercept) 41.1623  22.212
# lGDP        -8.3717 -10.389

screenreg(list(Modelo3, Modelo3.1))


# ===================================
# Model 1     Model 2   
# -----------------------------------
#  (Intercept)   46.57 ***  -31.69 ***
#  (1.04)      (4.79)   
# GDP            0.00 ***            
#  (0.00)               
# lGDP                       9.38 ***
#  (0.51)   
# -----------------------------------
#  R^2            0.55        0.71    
# Adj. R^2       0.55        0.71    
# Num. obs.    140         140       
# RMSE           9.11        7.35    
# ===================================
#  *** p < 0.001, ** p < 0.01, * p < 0.05


# Regressão Multivariada com variaveis ajustadas

Modelo5 <- lm (EnvironPerfor ~ Democ + GovEffect+ lGDP, data= Env_Demo_EFF_GDP)

summary (Modelo5)

# Call:
# lm(formula = EnvironPerfor ~ Democ + GovEffect + lGDP, data = Env_Demo_EFF_GDP)

# Residuals:
#  Min      1Q  Median      3Q     Max 
# -24.693  -3.441   0.648   4.702  13.634 

# Coefficients:
#  Estimate Std. Error t value           Pr(>|t|)    
# (Intercept)  -12.845      7.431   -1.73              0.086 .  
# Democ          1.048      0.383    2.74              0.007 ** 
#  GovEffect      2.421      1.097    2.21              0.029 *  
#  lGDP           6.734      0.759    8.88 0.0000000000000037 ***
#  ---
#  Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

# Residual standard error: 6.76 on 135 degrees of freedom
# (59 observations deleted due to missingness)
# Multiple R-squared:  0.756,	Adjusted R-squared:  0.751 
# F-statistic:  140 on 3 and 135 DF,  p-value: <0.0000000000000002


# Comparacao entre os modelos multivariados

screenreg(list(Modelo4, Modelo5))

# ===================================
# Model 1     Model 2   
# -----------------------------------
#  (Intercept)   43.08 ***  -12.85    
# (2.85)      (7.43)   
# Democ          1.39 **     1.05 ** 
#  (0.44)      (0.38)   
# GovEffect      4.20 **     2.42 *  
#  (1.28)      (1.10)   
# GDP            0.00 ***            
#  (0.00)               
# lGDP                       6.73 ***
#  (0.76)   
# -----------------------------------
#   R^2            0.68        0.76    
# Adj. R^2       0.67        0.75    
# Num. obs.    139         139       
# RMSE           7.72        6.76    
# ===================================
#  *** p < 0.001, ** p < 0.01, * p < 0.05

# A partir dos testes realizados com o modelo 4 e modelo 5, observamos que o modelo que apresenta maior capacidade de explicação da variavel dependente e o modelo 5. 

## observando o distribuicao de normalidade, erros e residuos: 

ols_plot_resid_qq(Modelo4)
ols_plot_resid_fit(Modelo4)

# o modelo alterado:

ols_plot_resid_qq(Modelo5)
ols_plot_resid_fit(Modelo5)

# Podemos observar que no modelo 5 os residuos  estao melhor distribuidos  em torno do 0.

ggplot(Env_Demo_EFF_GDP, aes(GDP, EnvironPerfor))+geom_point()+geom_smooth(method = "lm")
ggplot(Env_Demo_EFF_GDP, aes(lGDP, EnvironPerfor))+geom_point()+geom_smooth(method = "lm")


# Podemos verificar a elasticidade dos residuos a partir do teste de Breush_Pagan. 

bptest(Modelo5)

# studentized Breusch-Pagan test

# data:  Modelo5
# BP = 0.159, df = 3, p-value = 0.98

# Dado o p-valor (0.98), podemos dizer que a probabilidade de cometer um erro de 
# tipo I (afirmar que a hipotese nula e falsa, dado que ela e verdadeira) e alta. 
# Logo, concluimos que nao ha homocedasticidade nos residuos.


## Comparando Coeficientes

summary(Modelo5)

# padronizando coeficiente Democracy

coef(Modelo5)[2]* (sd(Env_Demo_EFF_GDP$Democ)/ sd(Env_Demo_EFF_GDP$EnvironPerfor)) 


# padronizando coef Governement Effect
coef(Modelo5)[3]* (sd(Env_Demo_EFF_GDP$GovEffect)/ sd(Env_Demo_EFF_GDP$EnvironPerfor))

# padronizando coef GDP

coef(Modelo5)[4]* (sd(Env_Demo_EFF_GDP$GDP)/ sd(Env_Demo_EFF_GDP$EnvironPerfor))

# Padronizando os coeficientes e possivel constatar que a variavel de crescimento 
# economico apresenta maior efeito/associacao sobre a variavel dependente.
